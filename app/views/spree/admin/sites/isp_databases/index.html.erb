<% content_for :page_title do %>
 Databases
<% end %>
<% content_for :page_actions do %>
  <%= button_link_to Spree.t(:add_database),
    new_admin_sites_isp_database_path,
    class: "btn-success",
      icon: 'add.svg',
      id: 'new_admin_database' %>
<% end %>

<% if @resources.any? %>
<div data-nav-x-wrapper>
  <div data-nav-x-container>
    <table class="table" id="listing_orders" data-hook data-nav-x-content>
      <thead>
        <tr data-hook="admin_orders_index_headers">
          <th>Database Name</th>
          <th>Database User</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <%= render partial: 'spree/admin/sites/isp_databases/index', collection: @resources, as: :database %>
      </tbody>
    </table>
  </div>
</div>
<% else %>
  <div class="alert alert-info no-objects-found">
    You haven't created any Database yet.
  </div>
<% end %>

<%= render partial: '/spree/admin/shared/modal/modal' %>

<script type="text/javascript">
  
  $(function () {
    $('[data-toggle="tooltip"]').tooltip();
  })

  $(document).ready(function (argument) {
    $('#FlashAlertsContainer').removeClass('d-none');

    $(document).on('click', '.configure-db-modal-link', function(){
      var databaseName = $(this).data('database');
      var userName = $(this).data('username');
      var pwdDiv = $(this).data('pwd-div-id');
      if($('#'+pwdDiv).is(':empty')){
        var password = $(this).data('password');
      }
      else{
        var password = $('#'+pwdDiv).html();
      }
      var host = $(this).data('host');
      var port = $(this).data('port');
      $('#exampleModalLabel').html("Database Configuration Details");
      $('#exampleModal .modal-body').html(`
        <table>
          <tbody>
            <tr>
              <td><b>Database&nbsp;Name:</b></td>
              <td>${databaseName}</td>
            </tr>
            <tr>
              <td><b>Username:</b></td>
              <td>${userName}</td>
            </tr>
            <tr>
              <td><b>Password:</b></td>
              <td>${password}</td>
            </tr>
            <tr>
              <td><b>Host:</b></td>
              <td>${host}</td>
            </tr>
            <tr>
              <td><b>Port:</b></td>
              <td>${port}</td>
            </tr>
          </tbody>
        </table>
      `);
      $('#modal-save-button').hide();
      $('#exampleModal').modal('show');
    });
  });

</script>
